<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Hello World</title>
  <link rel="stylesheet" href="css/style.css">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
    crossorigin="anonymous">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
    crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
  <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
  <script src="js/fbconnect.js"></script>
</head>

<body>

  <div class="container" id="root">

  </div>

  <script type="text/babel">
      
      class App extends React.Component{

        constructor(props)
        {
          super(props);

          this.state = {
                        name: "login",
                        token:"",
                        profileImg: "img/profile.png",
                        username: ""
                      };
        }

        handleLogin(infos){

          if(!infos)
            return false;

         // console.log(infos);

          this.setState({
                        name: "logout",
                        token: infos.authResponse.accessToken
                      });
          
          this.fbGraphRequest();
        }

        fbGraphRequest()
        {
          FB.api('/me', { fields: 'id,name,picture.type(large),albums{name,photos,cover_photo}' }, 'GET', (response)=>{

            console.log(response.picture.data.url);
            
            this.setState({
                             profileImg: response.picture.data.url,
                             username: response.name
                          });

          });
        }

        render(){
          return <div> 
                    <ProfileImg src={this.state.profileImg} username={this.state.username} /> 
                    <FbLogin name={this.state.name} getUserInfo={ this.handleLogin.bind(this) }  />
                </div>;
        } 

      }

      class FbLogin extends React.Component{

        constructor(props)
        {
          super(props);
        }

        handleClick(){

          FB.login((response)=>{

                if (response.authResponse)

                    this.props.getUserInfo(response);
                
                else
                    this.props.getUserInfo(false);

            }, { scope: 'email,user_photos' });
            
        }
        render(){
          return <button className="btn btn-primary" onClick={this.handleClick.bind(this)}><i className="fa fa-facebook" aria-hidden="true"></i> {this.props.name} </button>
        }

      }


      class ProfileImg extends React.Component{

        constructor(props)
        {
          super(props)
        }

        render(){
            return <div>
                      <img src={this.props.src}  className="img img-profile"/>
                      <h4 className="profile-name">{this.props.username}</h4>
                  </div>;
        }
      }

      ReactDOM.render(
        <App />,
        document.getElementById('root')
      );

    </script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>
</body>

</html>